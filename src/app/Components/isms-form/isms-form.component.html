<div class="ismsForm">
  <form [formGroup]="ismsForm" (ngSubmit)="onSubmit()" >
    <div class="form-details-sub-container">
      <h2>Risk Details</h2>
     <div class="form-row">
       <app-form-input label="Risk Name" required=" *" formControlName="riskName" ></app-form-input>
       @if(isAdmin!=='Admin'){
        <app-form-dropdown label="Project Name" [dropdownData]="dropdownProject" dropdownDisplay="name" dropdownValue="id" selectValue="Project" (change)="onDropdownChangeProject($event)" ></app-form-dropdown>
       }
       @if(isAdmin==='Admin'){
        <app-form-dropdown label="Project Name" [dropdownData]="dropdownDataProjectForAdmin" dropdownDisplay="name" dropdownValue="id" selectValue="Project" (change)="onDropdownChangeProject($event)" ></app-form-dropdown>
       }
      </div>
      @if(isAdmin === 'Admin'){
      <app-form-dropdown label="Department Name" [dropdownData]="dropdownDepartment" dropdownDisplay="departmentName" dropdownValue="id" selectValue="department" (change)="onDropdownChangeDepartment($event)"  ></app-form-dropdown>
      }
      <app-form-text-area label="Impact Of Risk" required="*" placeHolder="Enter impact of risk"
      message="Impact of a risk refers to the potential consequences or effects that a risk event
      may have on a project, system, or organization if it occurs. It can include financial loss,
      delays, operational disruptions, or damage to reputation." formControlName="impact"   [backgroundColor]="bgColor"></app-form-text-area>

      <app-form-text-area label="Description" required="*" placeHolder="Enter description of risk"
     message="Provide a detailed description of the risk, including what could cause it" formControlName="description"  [backgroundColor]="bgColor"></app-form-text-area>
    </div>
    <div class="form-details-sub-container">
      <h2>Current Risk Assessment</h2>
      <table  class="risk-assessment-table">
      <tr>
        <th></th>
        <th>Likelihood <span class="required">*</span></th>
        <th>Impact <span class="required">*</span></th>
        <th> <span style="margin-left: 30px;"> Risk Factor</span></th>
      </tr>
      <tr>
        <td><h2 [ngStyle]="{'border-bottom':'0px','text-transform':'none'}">Confidentiality</h2></td>
        <td>
            <app-form-dropdown  [dropdownData]="dropdownLikelihood" dropdownDisplay="assessmentFactor" dropdownValue="id" selectValue="Likelihood" (change)="onDropdownChange($event,'Likelihood','Confidentiality')"></app-form-dropdown>
        </td>
        <td>
            <app-form-dropdown  [dropdownData]="dropdownImpact" dropdownDisplay="assessmentFactor" dropdownValue="id" selectValue="Impact" (change)="onDropdownChange($event,'Impact','Confidentiality')"></app-form-dropdown>
        </td>
        <td><h2 [ngStyle]="{'border-bottom':'0px','text-transform':'none','margin-left':'5vw','color': changeColorRiskFactor('Confidentiality')}">{{confidentialityRiskFactor}}</h2></td>
      </tr>

      <tr>
        <td><h2 [ngStyle]="{'border-bottom':'0px','text-transform':'none'}">Integrity</h2></td>
        <td>
            <app-form-dropdown  [dropdownData]="dropdownLikelihood" dropdownDisplay="assessmentFactor" dropdownValue="id" selectValue="Likelihood" (change)="onDropdownChange($event,'Likelihood','Integrity')"></app-form-dropdown>
        </td>
        <td>
            <app-form-dropdown  [dropdownData]="dropdownImpact" dropdownDisplay="assessmentFactor" dropdownValue="id" selectValue="Impact" (change)="onDropdownChange($event,'Impact','Integrity')"></app-form-dropdown>
        </td>
        <td><h2 [ngStyle]="{'border-bottom':'0px','text-transform':'none','margin-left':'5vw','color': changeColorRiskFactor('Integrity')}">{{integrityRiskFactor}}</h2></td>
      </tr>

      <tr>
        <td><h2 [ngStyle]="{'border-bottom':'0px','text-transform':'none'}">Availability</h2></td>
        <td>
            <app-form-dropdown  [dropdownData]="dropdownLikelihood" dropdownDisplay="assessmentFactor" dropdownValue="id" selectValue="Likelihood" (change)="onDropdownChange($event,'Likelihood','Availability')"></app-form-dropdown>
        </td>
        <td>
            <app-form-dropdown  [dropdownData]="dropdownImpact" dropdownDisplay="assessmentFactor" dropdownValue="id" selectValue="Impact" (change)="onDropdownChange($event,'Impact','Availability')"></app-form-dropdown>
        </td>
        <td><h2 [ngStyle]="{'border-bottom':'0px','text-transform':'none','margin-left':'5vw','color': changeColorRiskFactor('Availability')}">{{availabilityRiskFactor}}</h2></td>
      </tr>

      <tr>
        <td><h2 [ngStyle]="{'border-bottom':'0px','text-transform':'none'}">Privacy</h2></td>
        <td>
            <app-form-dropdown  [dropdownData]="dropdownLikelihood" dropdownDisplay="assessmentFactor" dropdownValue="id" selectValue="Likelihood" (change)="onDropdownChange($event,'Likelihood','Privacy')"></app-form-dropdown>
        </td>
        <td>
            <app-form-dropdown  [dropdownData]="dropdownImpact" dropdownDisplay="assessmentFactor" dropdownValue="id" selectValue="Impact" (change)="onDropdownChange($event,'Impact','Privacy')"></app-form-dropdown>
        </td>
        <td><h2 [ngStyle]="{'border-bottom':'0px','text-transform':'none','margin-left':'5vw','color': changeColorRiskFactor('Privacy')}">{{privacyRiskFactor}}</h2></td>
      </tr>
      </table>
      <div class="form-row" [ngStyle]="{'margin-top':'30px'}">
       <h2 [ngStyle]="{'border-bottom':'0px','text-transform':'none'}">Overall Risk Rating : <span style="margin-left: 10px;" [ngStyle]="{'color': changeColorOverallRiskRating()}" >{{overallRiskRating}}</span></h2>
      </div>
      <p [ngStyle]="{'margin-top':'20px','font-style':'italic','color':'grey'}">Risk Factor = Likelihood * Impact</p>
      <p [ngStyle]="{'margin-top':'20px','font-style':'italic','color':'grey'}">Overall risk rating = Risk Factor(Confidentiality)+Risk Factor(Integrity)+Risk Factor(Availability)+Risk Factor(Privacy)</p>
      <div [ngStyle]="{'margin-top':'20px','font-style':'italic','color':'grey'}">
       <p>For reference <span><a href="javascript:void(0);">click </a></span>here</p>
      </div>
    </div>
    <div class="form-details-sub-container">
      <h2>Risk Management</h2>
      <app-form-text-area label="Risk Mitigation" required="*" placeHolder="Enter mitigation plan"
      message="Mitigation refers to actions taken to reduce the likelihood or impact of a risk.
      Ensure preventive measures, such as implementing safety protocols or backup systems, to minimize
      the risk." formControlName="mitigation"  [backgroundColor]="bgColor"></app-form-text-area>

      <app-form-text-area label="Risk Contingency" placeHolder="Enter contingency plan"
      message="Contingency planning involves preparing for unforeseen events by having backup
      plans in place. These plans help ensure that your project can continue with minimal disruption
      if unexpected risks occur." formControlName="contingency"  [backgroundColor]="bgColor"></app-form-text-area>
    </div>
    <div class="form-details-sub-container">
      <h2>Action Plan</h2>
      @if(isAdmin === 'Admin'){
        <app-form-dropdown label="Responsibility of action" required="*" [dropdownData]="dropdownAssigneeForAdmin" dropdownDisplay="fullName" dropdownValue="id" selectValue="responsible person" (change)="onDropdownChangeResponsiblePerson($event)"></app-form-dropdown>
      }
       @if(isAdmin !== 'Admin'){
        <app-form-dropdown label="Responsibility of action" required="*" [dropdownData]="dropdownAssignee" dropdownDisplay="fullName" dropdownValue="id" selectValue="responsible person" (change)="onDropdownChangeResponsiblePerson($event)"></app-form-dropdown>
       }
      <div [ngStyle]="{'margin-top':'20px','font-style':'italic','color':'grey'}">
        <p>If responsible person not in the list <span (click)="isAssigneeNotInList()" ><a href="javascript:void(0);">click </a></span>here</p>
      </div>
      @if(assigneeNotInList){

        <app-form-data-not-in-list placeholder="Enter responsible person name" [isAssignee]="true" textLabel="Responsible person name" [dropdownDepartment]="dropdownDepartment" (cancelForm)="receiveCancel($event)" (sendData)="saveAssignee($event)" [bgColor]="bgColor"></app-form-data-not-in-list>


      }
      <app-form-date-field label="Planned Action Date" required="*" formControlName="plannedActionDate"></app-form-date-field>
    </div>
    <div class="form-details-sub-container">
      <h2>Reviewer</h2>
      <app-form-dropdown label="Reviewer" required="*" [dropdownData]="dropdownReviewer" dropdownDisplay="fullName" dropdownValue="fullName" selectValue="reviewer" (change)="onDropdownChangeReviewer($event)"></app-form-dropdown>
      <div [ngStyle]="{'margin-top':'20px','font-style':'italic','color':'grey'}">
        <p>If reviewer not in the list <span (click)="isReviewerNotInList()" ><a href="javascript:void(0);">click </a></span>here</p>
      </div>
      @if(reviewerNotInList){
        <app-form-data-not-in-list placeholder="Enter reviewer name" [isAssignee]="false" textLabel="Reviewer name" [dropdownDepartment]="dropdownDepartment" (cancelForm)="receiveCancel($event)" (sendData)="saveReviewer($event)" [bgColor]="bgColor"></app-form-data-not-in-list>
      }
    </div>
    <div class="form-details-sub-container">
      <div class="button-group">
         <app-form-button label="Save" type="submit" (clicked)="saveConfirmation()"></app-form-button>
         <app-form-button label="Save Draft" (clicked)="saveAsDraft()"></app-form-button>
         <app-form-button label="Clear" (clicked)="clearAllData()"></app-form-button>
         <app-form-button label="Cancel" (clicked)="cancelRisk()"></app-form-button>
      </div>
    </div>
  </form>
</div>

