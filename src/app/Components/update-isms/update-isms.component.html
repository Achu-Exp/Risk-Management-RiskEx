<div class="qmsForm">
  <form [formGroup]="updateQmsForm" (ngSubmit)="onSubmit()">
    <div class="form-details-sub-container">
      <h2>Current Risk Assessment</h2>
      <table  class="risk-assessment-table">
      <tr>
        <th></th>
        <th>Likelihood <span class="required">*</span></th>
        <th>Impact <span class="required">*</span></th>
        <th> <span style="margin-left: 30px;"> Risk Factor</span></th>
      </tr>
      <tr>
        <td><h2 [ngStyle]="{'border-bottom':'0px','text-transform':'none'}">Confidentiality</h2></td>
        <td>
            <app-form-dropdown  [dropdownData]="dropdownLikelihood" dropdownDisplay="assessmentFactor" dropdownValue="id" selectValue="Likelihood" (change)="onDropdownChange($event,'Likelihood','Confidentiality')" [openDropdownId]="openDropdownId" (openDropdown)="handleDropdownOpen($event)"></app-form-dropdown>
        </td>
        <td>
            <app-form-dropdown  [dropdownData]="dropdownImpact" dropdownDisplay="assessmentFactor" dropdownValue="id" selectValue="Impact" (change)="onDropdownChange($event,'Impact','Confidentiality')" [openDropdownId]="openDropdownId" (openDropdown)="handleDropdownOpen($event)"></app-form-dropdown>
        </td>
        <td><h2 [ngStyle]="{'border-bottom':'0px','text-transform':'none','margin-left':'5vw','color': changeColorRiskFactor('Confidentiality')}">{{confidentialityRiskFactor}}</h2></td>
      </tr>

      <tr>
        <td><h2 [ngStyle]="{'border-bottom':'0px','text-transform':'none'}">Integrity</h2></td>
        <td>
            <app-form-dropdown  [dropdownData]="dropdownLikelihood" dropdownDisplay="assessmentFactor" dropdownValue="id" selectValue="Likelihood" (change)="onDropdownChange($event,'Likelihood','Integrity')" [openDropdownId]="openDropdownId" (openDropdown)="handleDropdownOpen($event)"></app-form-dropdown>
        </td>
        <td>
            <app-form-dropdown  [dropdownData]="dropdownImpact" dropdownDisplay="assessmentFactor" dropdownValue="id" selectValue="Impact" (change)="onDropdownChange($event,'Impact','Integrity')" [openDropdownId]="openDropdownId" (openDropdown)="handleDropdownOpen($event)"></app-form-dropdown>
        </td>
        <td><h2 [ngStyle]="{'border-bottom':'0px','text-transform':'none','margin-left':'5vw','color': changeColorRiskFactor('Integrity')}">{{integrityRiskFactor}}</h2></td>
      </tr>

      <tr>
        <td><h2 [ngStyle]="{'border-bottom':'0px','text-transform':'none'}">Availability</h2></td>
        <td>
            <app-form-dropdown  [dropdownData]="dropdownLikelihood" dropdownDisplay="assessmentFactor" dropdownValue="id" selectValue="Likelihood" (change)="onDropdownChange($event,'Likelihood','Availability')" [openDropdownId]="openDropdownId" (openDropdown)="handleDropdownOpen($event)"></app-form-dropdown>
        </td>
        <td>
            <app-form-dropdown  [dropdownData]="dropdownImpact" dropdownDisplay="assessmentFactor" dropdownValue="id" selectValue="Impact" (change)="onDropdownChange($event,'Impact','Availability')" [openDropdownId]="openDropdownId" (openDropdown)="handleDropdownOpen($event)"></app-form-dropdown>
        </td>
        <td><h2 [ngStyle]="{'border-bottom':'0px','text-transform':'none','margin-left':'5vw','color': changeColorRiskFactor('Availability')}">{{availabilityRiskFactor}}</h2></td>
      </tr>

      <tr>
        <td><h2 [ngStyle]="{'border-bottom':'0px','text-transform':'none'}">Privacy</h2></td>
        <td>
            <app-form-dropdown  [dropdownData]="dropdownLikelihood" dropdownDisplay="assessmentFactor" dropdownValue="id" selectValue="Likelihood" (change)="onDropdownChange($event,'Likelihood','Privacy')" [openDropdownId]="openDropdownId" (openDropdown)="handleDropdownOpen($event)"></app-form-dropdown>
        </td>
        <td>
            <app-form-dropdown  [dropdownData]="dropdownImpact" dropdownDisplay="assessmentFactor" dropdownValue="id" selectValue="Impact" (change)="onDropdownChange($event,'Impact','Privacy')" [openDropdownId]="openDropdownId" (openDropdown)="handleDropdownOpen($event)"></app-form-dropdown>
        </td>
        <td><h2 [ngStyle]="{'border-bottom':'0px','text-transform':'none','margin-left':'5vw','color': changeColorRiskFactor('Privacy')}">{{privacyRiskFactor}}</h2></td>
      </tr>
      </table>
      <div class="form-row" [ngStyle]="{'margin-top':'30px'}">
       <h2 [ngStyle]="{'border-bottom':'0px','text-transform':'none'}">Overall Risk Rating : <span style="margin-left: 10px;" [ngStyle]="{'color': changeColorOverallRiskRating()}" >{{overallRiskRating}}</span></h2>
      </div>
      <div [ngStyle]="{'margin-top':'20px','font-style':'italic','color':'grey'}">
       <p>For reference <span (click)="isHeatMapReference()"><a href="javascript:void(0);">click </a></span>here</p>
      </div>
    </div>
    <div class="form-details-sub-container" >
      <h2>RISK CLOSURE</h2>
      <app-form-date-field label="Actual Close Date" required="*" formControlName="closeDate" ></app-form-date-field>
      <app-form-risk-response label="Risk Response" required="*" [riskResponses]="riskResponses" (selectedValueChange)="onRadioSelectionChange($event)" [bgColor]="bgColor"></app-form-risk-response>
    </div>
    <div class="form-details-sub-container">
      <h2>Reviewer</h2>
      <app-form-dropdown label="Reviewer" required="*" [dropdownData]="dropdownReviewer" dropdownDisplay="fullName"
      dropdownValue="fullName" selectValue="reviewer" (change)="onDropdownChangeReviewer($event)"
      [openDropdownId]="openDropdownId" (openDropdown)="handleDropdownOpen($event)" message="You can select an existing reviewer from the dropdown
      or enter a new one. If you enter a new name, it will take priority over the dropdown selection." [backgroundColor]="bgColor"></app-form-dropdown>

      <div [ngStyle]="{'margin-top':'20px','font-style':'italic','color':'grey'}">
        <p>If reviewer not in the list <span (click)="isReviewerNotInList()" ><a href="javascript:void(0);">click </a></span>here</p>
      </div>

    </div>
    <div class="form-details-sub-container">
      <h2>Remarks</h2>
      <app-form-text-area label="Remarks" required="*" placeHolder="Enter remark"
      message="Remarks on risk after mitigation indicate the effectiveness of applied controls,
      the remaining (residual) risk level, and whether further actions are needed to manage the
      risk within acceptable limits."  formControlName="remarks" [backgroundColor]="bgColor"></app-form-text-area>
    </div>
    <div class="form-details-sub-container">
      <div class="button-group">
         <app-form-button label="Save" type="submit" (clicked)="saveConfirmation()"></app-form-button>
         <app-form-button label="Save Draft" (clicked)="saveAsDraft()"></app-form-button>
         <app-form-button label="Clear" (clicked)="clearAllData()"></app-form-button>
         <app-form-button label="Cancel" (clicked)="cancelRisk()"></app-form-button>
      </div>
    </div>
  </form>
  @if(HeatMapRefernce){
    <h5>For Reference</h5>
    <app-form-reference-heatmap-popup (closeHeatMap)="closeHeatMap()"></app-form-reference-heatmap-popup>
   }
  @if(reviewerNotInList){
    <app-form-data-not-in-list placeholder="Enter reviewer name" [isAssignee]="false" textLabel="Reviewer name" [dropdownDepartment]="dropdownDepartment" (cancelForm)="receiveCancel($event)" (sendData)="saveReviewer($event)" [bgColor]="bgColor" [openDropdownId]="openDropdownId" (openDropdown)="handleDropdownOpen($event)"></app-form-data-not-in-list>
  }
  @if(isSuccessReviewer){
    <app-form-successfull
    message="Add new reviewer successfully!"
    [isSuccessfull] ="true"
    (closeDialog)="closeReviewer()" [bgColor]="bgColor">
    </app-form-successfull>
 }
 @if(isErrorReviewer){
  <app-form-successfull
  message="Something went Wrong!"
  [isSuccessfull] ="false"
  (closeDialog)="closeReviewer()" [bgColor]="bgColor">
  </app-form-successfull>
}
</div>

