<div class="qmsForm">
  <form [formGroup]="qmsForm" (ngSubmit)="onSubmit()">
    <div class="form-details-sub-container">
      <h2>Risk Details</h2>
      <div class="form-row">
       <app-form-input label="Risk Name" required=" *" formControlName="riskName"></app-form-input>
       <app-form-dropdown label="Project Name" [dropdownData]="dropdownProject" dropdownDisplay="name" dropdownValue="id" selectValue="Project" (change)="onDropdownChangeProject($event)" ></app-form-dropdown>
     </div>
     @if(isAdmin === 'Admin'){
      <app-form-dropdown label="Department Name" [dropdownData]="dropdownDepartment" dropdownDisplay="departmentName" dropdownValue="id" selectValue="department" (change)="onDropdownChangeDepartment($event)" ></app-form-dropdown>
     }
     <app-form-text-area label="Impact Of Risk" required="*" placeHolder="Enter impact of risk"
      message="Impact of a risk refers to the potential consequences or effects that a risk event
      may have on a project, system, or organization if it occurs. It can include financial loss,
      delays, operational disruptions, or damage to reputation."  formControlName="impact" [backgroundColor]="bgColor"></app-form-text-area>

      <app-form-text-area label="Description" required="*" placeHolder="Enter description of risk"
      message="Provide a detailed description of the risk, including what could cause it" formControlName="description" [backgroundColor]="bgColor"></app-form-text-area>
    </div>
    <div class="form-details-sub-container">
      <h2>Current Risk Assessment</h2>
      <div class="form-row">
        <app-form-dropdown label="Likelihood" [dropdownData]="dropdownLikelihood" dropdownDisplay="assessmentFactor" dropdownValue="id" selectValue="Likelihood" (change)="onDropdownChangelikelihood($event)" ></app-form-dropdown>
        <app-form-dropdown label="Impact" [dropdownData]="dropdownImpact" dropdownDisplay="assessmentFactor" dropdownValue="id" selectValue="Impact" (change)="onDropdownChangeImpact($event)" ></app-form-dropdown>
      </div>
      <div class="form-row" [ngStyle]="{'gap':'32vw','margin-top':'30px'}">
        <h2 [ngStyle]="{'border-bottom':'0px','text-transform':'none'}">Risk Factor :<span style="margin-left: 10px;">{{riskFactor}}</span> </h2>
        <h2 [ngStyle]="{'border-bottom':'0px','text-transform':'none','margin-left':'-37%'}">Overall Risk Rating :<span style="margin-left: 10px;" [ngStyle]="{'color':changeColorOverallRiskRating()}"> {{overallRiskRating}}</span> </h2>
      </div>
      <p [ngStyle]="{'margin-top':'20px','font-style':'italic','color':'grey'}">Overall risk rating = Likelihood * Impact</p>
      <div [ngStyle]="{'margin-top':'20px','font-style':'italic','color':'grey'}">
       <p>For more reference <span><a href="javascript:void(0);"  >click </a></span> here</p>
      </div>
    </div>
    <div class="form-details-sub-container">
      <h2>Risk Management</h2>
      <app-form-text-area label="Risk Mitigation" required="*" placeHolder="Enter mitigation plan"
      message="Mitigation refers to actions taken to reduce the likelihood or impact of a risk.
      Ensure preventive measures, such as implementing safety protocols or backup systems, to minimize
      the risk." formControlName="mitigation" [backgroundColor]="bgColor"></app-form-text-area>

      <app-form-text-area label="Risk Contingency" placeHolder="Enter contingency plan"
      message="Contingency planning involves preparing for unforeseen events by having backup
      plans in place. These plans help ensure that your project can continue with minimal disruption
      if unexpected risks occur." formControlName="contingency" [backgroundColor]="bgColor"></app-form-text-area>
    </div>
    <div class="form-details-sub-container">
      <h2>Action Plan</h2>
      <app-form-dropdown label="Responsibility of action" required="*" [dropdownData]="dropdownAssignee" dropdownDisplay="fullName" dropdownValue="id" selectValue="responsible person" (change)="onDropdownChangeResponsiblePerson($event)"></app-form-dropdown>
      <div [ngStyle]="{'margin-top':'20px','font-style':'italic','color':'grey'}">
        <p>If responsible person not in the list <span (click)="isAssigneeNotInList()"><a href="javascript:void(0);">click </a></span>here</p>
      </div>
      @if(assigneeNotInList){
        <form [formGroup]="assigneeGroup">
          <div class="form-detail">
            <label for="assignee">Responsible Person Name <span class="required">*</span></label>
            <input type="text" id="assignee" placeholder="Enter responsible person full name" formControlName="fullName"  >
          </div>
          <div class="form-detail">
            <label for="assignee-email">Email <span class="required">*</span></label>
            <input type="text" id="assignee-email" placeholder="Enter email" formControlName="email" >
          </div>
          <div class="button-group">
            <button type="button" class="btn save" (click)="saveAssignee()" >Save</button>
            <button type="button" class="btn cancel" (click)="isAssigneeNotInList()">Cancel</button>
          </div>
        </form>


      }
      <app-form-date-field label="Planned Action Date" required="*" formControlName="plannedActionDate"></app-form-date-field>
    </div>
    <div class="form-details-sub-container">
      <h2>Reviewer</h2>
      <app-form-dropdown label="Reviewer" required="*" [dropdownData]="dropdownReviewer" dropdownDisplay="fullName" dropdownValue="fullName" selectValue="reviewer" (change)="onDropdownChangeReviewer($event)"></app-form-dropdown>

      <div [ngStyle]="{'margin-top':'20px','font-style':'italic','color':'grey'}">
        <p>If reviewer not in the list <span (click)="isReviewerNotInList()"><a href="javascript:void(0);">click </a></span>here</p>
      </div>
      @if(reviewerNotInList){
        <form [formGroup]="reviewerGroup">
          <div class="form-detail">
            <label for="reviewer">Reviewer Name <span class="required">*</span></label>
            <input type="text" id="reviewer" placeholder="Enter reviewer name" formControlName="fullName" >
          </div>
          <div class="form-detail">
            <label for="reviewer-email">Email <span class="required">*</span></label>
            <input type="text" id="reviewer-email" placeholder="Enter email" formControlName="email" >
          </div>
          <div class="form-detail">
            <label for="department">Department Name</label>
            <app-dropdown  [options]="dropdownDepartment"
              [displayField]="'departmentName'"
              [valueField]="'id'"
              selectValue="reviewer"
              width="100" id="reviewer-department" formControlName="departmentId"  >
             </app-dropdown>
          </div>
        </form>
        <div class="button-group">
          <button type="button" class="btn save" (click)="saveExternalReviewer()" >Save</button>
          <button type="button" class="btn cancel" (click)="isReviewerNotInList()">Cancel</button>
        </div>

      }
    </div>
    <div class="button-group">
      <button type="submit" class="btn save">Save</button>
      <button type="button" class="btn cancel">Cancel</button>
      <button type="button" class="btn clear">Clear</button>
    </div>
  </form>
</div>


